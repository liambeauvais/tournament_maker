{% extends "base/base.html" %}
{% load custom_filters %}
{% load bootstrap5 %}

{# Load CSS and JavaScript #}
{% bootstrap_css %}
{% bootstrap_javascript %}

{# Display django.contrib.messages as Bootstrap alerts #}

{% block content %}
    <div class="p-2">
        <div class="row">
            <div class="col-8">
                <div class="row">
                    <div class="col-5">
                        <p class="fs-1">Seconde phase</p>
                    </div>
                    <div class="col-7 my-auto align-center">
                        <a class="btn btn-danger" href="{% url 'cancel_steps' first_step.tournament.pk 2 %}">ANNULER
                            CETTE
                            PHASE</a>
                    </div>
                </div>
            </div>
            <div class="col-4 d-flex justify-content-center align-items-center gap-2">
                <a class="btn btn-primary" href="{% url 'steps_pdf' first_step.pk 2 %}" target="_blank">Imprimer les
                    poules</a>
                {% if steps_are_done %}
                    {% if not_created %}
                        <form class="row" method="post" action="{% url 'create_final_steps' first_step.pk %}">
                            {% csrf_token %}
                            <div class="col">
                                <label for="set_number">
                                    Nombre de Manches
                                </label>
                                <select class="form-select" id="set_number" name="set_number">
                                    <option value="3">3</option>
                                    <option value="5">5</option>
                                </select>
                            </div>
                            <div class="col">
                                <button type="submit" class="btn btn-primary">Créer le tableau
                                    final
                                </button>
                            </div>
                        </form>
                    {% else %}
                        <a class="btn btn-primary" href="{% url 'final_steps' first_step.tournament.pk %}">Accéder au
                            tableau
                            final</a>
                    {% endif %}
                {% else %}
                    <a class="btn btn-primary disabled">Passer au tableau final</a>
                {% endif %}
            </div>
        </div>
        {% for step in steps|dictsort:"rank" %}
            <hr>
            <div class="row mb-4">
                <div class="col-2">Poules des rangs {{ step.rank }}</div>
                <div class="col-10">
                    {% if step.is_done %}
                        <a href="{% url 'step_pdf' step.pk %}" target="_blank" class="btn btn-primary">Imprimer la
                            suite</a>
                    {% endif %}
                </div>


            </div>
            <div class="row d-flex justify-content-around gap-3">
                {% for pool in step.pools.all %}
                    {% include "step/components/pool.html" %}
                {% endfor %}
            </div>
        {% endfor %}
    </div>
{% endblock %}